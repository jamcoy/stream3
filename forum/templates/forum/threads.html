{% extends "forum/forum_base.html" %}
{% load thread_extras %}
{% block forum_content %}

    <div class="row">

        {% if user.is_authenticated %}
            <div class="col-xs-7 col-sm-8 col-md-9">
        {% else %}
            <div class="col-lg-12">
        {% endif %}
                <ol class="breadcrumb">
                    <li><a href="{% url 'forum_forums' %}">Forums</a></li>
                    <li class="active">{{ subject.name | truncatechars:35 }}</li>
                </ol>
            </div>

        {% if user.is_authenticated %}
            <div class="col-xs-5 col-sm-4 col-md-3">
                <p class="pull-right">
                    <a href="{% url 'forum_new_thread' subject.id 'no_poll' %}" class="btn btn-primary">New topic</a>
                    <a href="{% url 'forum_new_thread' subject.id 'poll' %}" class="btn btn-primary">New poll</a>
                </p>
            </div>
        {% endif %}

    </div>

    <h2>{{ subject.name }}</h2>

    <table class="table table-striped table-hover">
        <tr>
            <th>TOPIC</th>
            <th>CREATOR</th>
            <th>POSTS</th>
            <th>LAST POST</th>
            <th>FRESHNESS</th>
        </tr>
        {% for thread in subject.threads.all %}
            <tr>
                <td>
                    <a href="{% url 'forum_thread' thread.id %}">
                        {% if thread.poll %}
                            {{ thread.name | truncatechars:30 }}
                            <span class="badge">POLL</span>
                        {% else %}
                            {{ thread.name | truncatechars:35 }}
                        {% endif %}
                    </a>
                </td>
                <td>{{ thread.user.public_name }}</td>
                <td>{% get_total_thread_posts thread %}</td>
                <td>{% last_posted_user_name thread %}</td>
                <td><time>{% last_post_time thread %}</time></td>
            </tr>
        {% endfor %}
    </table>
{% endblock %}